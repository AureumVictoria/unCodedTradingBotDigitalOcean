# .do/deploy.template.yaml
spec:
  name: trading-bot-app

  workers:
    - name: trading-bot
      instance_size_slug: apps-s-1vcpu-0.5gb   # $5 shared tier
      instance_count: 1
      image:
        registry_type: DOCKER_HUB
        registry: aureumvictoria
        repository: uncoded-trading-bot
        tag: "2025.09.09"
      envs:
        # ---- 1) ZUERST: App-/API-ENVs ----
        - key: API_KEY
          scope: RUN_TIME
          type: SECRET
        - key: API_SECRET
          scope: RUN_TIME
          type: SECRET

        # ---- 2) Dann: Proxy-ENVs (Outbound über Droplet-Proxy) ----
        # Format: scheme://USER:PASS@IP:PORT
        - key: HTTPS_PROXY
          scope: RUN_TIME
          value: "http://YOUR_PROXY_USER:YOUR_PROXY_PASS@YOUR_DROPLET_RESERVED_IP:3128"
        - key: HTTP_PROXY
          scope: RUN_TIME
          value: "http://YOUR_PROXY_USER:YOUR_PROXY_PASS@YOUR_DROPLET_RESERVED_IP:3128"
        # Ziele, die NICHT über den Proxy gehen sollen (DB intern etc.)
        - key: NO_PROXY
          scope: RUN_TIME
          value: "${db.HOSTNAME},localhost,127.0.0.1,::1"

        # ---- 3) Unten: DB-ENVs (Option B Mapping) ----
        - key: POSTGRES_HOST
          scope: RUN_TIME
          value: "${db.HOSTNAME}"
        - key: POSTGRES_PORT
          scope: RUN_TIME
          value: "${db.PORT}"
        - key: POSTGRES_DB
          scope: RUN_TIME
          value: "${db.DATABASE}"
        - key: POSTGRES_USER
          scope: RUN_TIME
          value: "${db.USERNAME}"
        - key: POSTGRES_PASSWORD
          scope: RUN_TIME
          value: "${db.PASSWORD}"
        - key: DATABASE_URL
          scope: RUN_TIME
          value: "${db.DATABASE_URL}"

    - name: telegram-bot
      instance_size_slug: apps-s-1vcpu-0.5gb   # $5 shared tier
      instance_count: 1
      image:
        registry_type: DOCKER_HUB
        registry: aureumvictoria
        repository: uncoded-telegram-bot
        tag: "2025.09.09"
      envs:
        # ---- 1) ZUERST: Telegram-ENVs ----
        - key: TELEGRAM_BOT_TOKEN
          scope: RUN_TIME
          type: SECRET
          value: "535695104:AAF43-oaqF9GVRkBW3UFnxESIbJXdVCZA58"
        - key: TELEGRAM_GROUP_ID
          scope: RUN_TIME
          value: "-1002896686710"
        - key: TELEGRAM_OWNER_ID
          scope: RUN_TIME
          value: "545568537"

        # ---- 2) Dann: Proxy-ENVs (Outbound über Droplet-Proxy) ----
        - key: HTTPS_PROXY
          scope: RUN_TIME
          value: "http://YOUR_PROXY_USER:YOUR_PROXY_PASS@YOUR_DROPLET_RESERVED_IP:3128"
        - key: HTTP_PROXY
          scope: RUN_TIME
          value: "http://YOUR_PROXY_USER:YOUR_PROXY_PASS@YOUR_DROPLET_RESERVED_IP:3128"
        - key: NO_PROXY
          scope: RUN_TIME
          value: "${db.HOSTNAME},localhost,127.0.0.1,::1"

        # ---- 3) Unten: DB-ENVs (Option B Mapping) ----
        - key: POSTGRES_HOST
          scope: RUN_TIME
          value: "${db.HOSTNAME}"
        - key: POSTGRES_PORT
          scope: RUN_TIME
          value: "${db.PORT}"
        - key: POSTGRES_DB
          scope: RUN_TIME
          value: "${db.DATABASE}"
        - key: POSTGRES_USER
          scope: RUN_TIME
          value: "${db.USERNAME}"
        - key: POSTGRES_PASSWORD
          scope: RUN_TIME
          value: "${db.PASSWORD}"
        - key: DATABASE_URL
          scope: RUN_TIME
          value: "${db.DATABASE_URL}"

  databases:
    - name: db
      engine: PG
      version: "16"
      production: false   # 1-Klick kompatibel
