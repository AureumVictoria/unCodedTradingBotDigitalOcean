# .do/deploy.template.yaml
spec:
  name: trading-bot-app

  # Beide Container sind Worker (kein HTTP-Endpunkt)
  workers:
    - name: trading-bot
      image:
        registry_type: DOCKER_HUB
        registry: aureumvictoria
        repository: uncoded-trading-bot
        tag: "2025.09.09"
      envs:
        # ---- DB-Mapping (Option B) ----
        - key: POSTGRES_HOST
          scope: RUN_TIME
          value: "${db.HOSTNAME}"
        - key: POSTGRES_PORT
          scope: RUN_TIME
          value: "${db.PORT}"
        - key: POSTGRES_DB
          scope: RUN_TIME
          value: "${db.DATABASE}"
        - key: POSTGRES_USER
          scope: RUN_TIME
          value: "${db.USERNAME}"
        - key: POSTGRES_PASSWORD
          scope: RUN_TIME
          value: "${db.PASSWORD}"
        # Zusätzlich die komplette URL (falls dein Code sie optional nutzt)
        - key: DATABASE_URL
          scope: RUN_TIME
          value: "${db.DATABASE_URL}"

        # ---- Deine Secrets / sonstige ENVs ----
        - key: API_KEY
          scope: RUN_TIME
          type: SECRET
        - key: API_SECRET
          scope: RUN_TIME
          type: SECRET
        - key: DOCKER_ENV
          scope: RUN_TIME
          value: "true"

    - name: telegram-bot
      image:
        registry_type: DOCKER_HUB
        registry: aureumvictoria
        repository: uncoded-telegram-bot
        tag: "2025.09.09"
      envs:
        # ---- DB-Mapping (Option B) ----
        - key: POSTGRES_HOST
          scope: RUN_TIME
          value: "${db.HOSTNAME}"
        - key: POSTGRES_PORT
          scope: RUN_TIME
          value: "${db.PORT}"
        - key: POSTGRES_DB
          scope: RUN_TIME
          value: "${db.DATABASE}"
        - key: POSTGRES_USER
          scope: RUN_TIME
          value: "${db.USERNAME}"
        - key: POSTGRES_PASSWORD
          scope: RUN_TIME
          value: "${db.PASSWORD}"
        # Zusätzlich die komplette URL
        - key: DATABASE_URL
          scope: RUN_TIME
          value: "${db.DATABASE_URL}"

        # ---- Deine Secrets / sonstige ENVs ----
        - key: TELEGRAM_TOKEN
          scope: RUN_TIME
          type: SECRET
        - key: DOCKER_ENV
          scope: RUN_TIME
          value: "true"

  # Verwaltete Postgres-DB (Dev-Plan für 1-Klick Deploy)
  databases:
    - name: db
      engine: PG
      version: "16"
      production: false
